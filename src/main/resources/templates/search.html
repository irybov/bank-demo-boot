<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
<meta charset="UTF-8">
<title>Admin's area</title>
	<style>
	    .error {
	        color: red;
	    }
	</style>
</head>
<body>

<h3>Admin's area</h3>
<hr>
<br>
	<p th:text="${admin.name} + ' ' + ${admin.surname}"></p>
	<p sec:authentication="principal.authorities"></p>
<form th:action="@{/bankdemo/accounts/password/{phone}(phone=${admin.phone})}" method="get">
	<button type="submit" class="btn btn-default">Change password</button>
</form>
<hr>
<br>

<div sec:authorize="hasRole('ADMIN')">
<input type="button" value="Health" onclick="window.location.href = '/bankdemo/actuator/health'">
<input type="button" value="Info" onclick="window.location.href = '/bankdemo/actuator/info'">
</div>
<hr>
<br>

<div sec:authorize="hasRole('ADMIN')">
<form th:action="@{/bankdemo/accounts/search}" method="get">
	<p>
		<input type="text" th:name="phone" id="phone" class="form-control" pattern="^[0-9]{10}"
		 placeholder="Phone" required autofocus/>
		 <button type="submit" class="btn btn-info">Search</button>
	</p>
</form>	
</div>

<hr>
<br>

<div sec:authorize="hasRole('ADMIN')" th:if="${target}">
<table>
	<thead>
		<tr>
			<th style="text-align: center;">Id</th>
			<th style="text-align: center;">Name</th>
			<th style="text-align: center;">Surname</th>
			<th style="text-align: center;">Phone</th>
			<th></th>
			<th style="text-align: center;">Birthday</th>
			<th style="text-align: center;">isActive</th>
		</tr>
	</thead>
	<tr>
		<td align="center" th:text="${target.id}"></td>		
	    <td align="center" th:text="${target.name}"></td>
	    <td align="center" th:text="${target.surname}"></td>
	    <td align="center" th:text="${target.phone}"></td>
	    <td></td>
	    <td align="center" th:text="${#dates.format(target.birthday, 'yyyy-MM-dd')}"></td>
	    <td align="center" th:text="${target.active}"></td>
	    <td>
	    	<form th:action="@{/bankdemo/accounts/status/{phone}(phone=${target.phone})}"
			 th:method="patch">
	    			<button type="submit" class="btn btn-danger"
					onclick="if (!(confirm('Are you sure you want to switch the status?')))
					return false">Switch<br/>status</button>
			</form>						
		</td>
	</tr>	     
</table>
</div>

<hr>

<div sec:authorize="hasRole('ADMIN')" th:if="${target}">
<table>
	<thead>
		<tr>
			<th style="text-align: center;">Id</th>
			<th style="text-align: center;">Balance</th>
			<th style="text-align: center;">Currency</th>
			<th style="text-align: center;">isActive</th>
			<th style="text-align: center;">Actions</th>									
		</tr>
	</thead>
	<tr th:each="bill: ${target.bills}">
		<td align="center" th:text="${bill.id}"></td>
	    <td align="center" th:text="${bill.balance}"></td>
	    <td align="center" th:text="${bill.currency}"></td>
	    <td align="center" th:text="${bill.active}"></td>	    
	    
	    <td align="center">
	    <div>
	    	<form style='display:inline;'
	    	 th:action="@{/bankdemo/bills/status/{phone}(phone=${target.phone})}"
			 th:method="patch">
			<input type="hidden" th:name="id" th:value="${bill.id}"/>			 
	    			<button type="submit" class="btn btn-danger"
					onclick="if (!(confirm('Are you sure you want to switch the status?')))
					return false">Switch<br/>status</button>
			</form>
			<form style='display:inline;'
			 th:action="@{/bankdemo/operations/list}"
			  method="get">
			<input type="hidden" th:name="id" th:value="${bill.id}"/>
			<input type="hidden" th:name="phone" th:value="${target.phone}"/>			 
	    			<button type="submit" class="btn btn-primary">Show<br/>events</button>
			</form>
		</div>									
		</td>
	</tr>    
</table>
</div>

<hr>

<div sec:authorize="hasRole('ADMIN')" th:if="${operations}">
<table>
	<thead>
		<tr>
			<th style="text-align: center;">Id</th>
			<th style="text-align: center;">Event</th>
			<th></th>			
			<th style="text-align: center;">Amount</th>			
			<th style="text-align: center;">Currency</th>
			<th style="text-align: center;">From</th>
			<th style="text-align: center;">To</th>
			<th></th>			
			<th style="text-align: center;">TimeStamp</th>
		</tr>
	</thead>
	<tr th:each="operation: ${operations}">
		<td align="center" th:text="${operation.id}"></td>		
	    <td align="center" th:text="${operation.action}"></td>
	    <td></td>	    
	    <td align="center" th:text="${operation.amount}"></td>
	    <td align="center" th:text="${operation.currency}"></td>
	    <td align="center" th:text="${operation.sender}"></td>
	    <td align="center" th:text="${operation.recipient}"></td>
	    <td></td>	    	    
	    <td align="center" th:text="${operation.timestamp}"></td>
	</tr>	     
</table>
</div>

<p th:text="${message}" class="error"/>
<br>

<form th:action="@{/bankdemo/logout}" method="post">
	<input type="submit" th:value="LogOut" class="btn btn-primary"/>
</form>

</body>
</html>